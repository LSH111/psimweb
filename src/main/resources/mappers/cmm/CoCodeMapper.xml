<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.psim.web.cmm.mapper.CoCodeMapper">

    <!-- 그룹코드별 공통코드 목록 조회 -->
    <select id="selectCodeListByGroup" parameterType="string" resultType="com.psim.web.cmm.vo.CoCodeVO">
        SELECT
            group_cd as groupCd,
            code_cd as codeCd,
            code_nm as codeNm,
            use_yn as useYn
        FROM cpk.tb_co_code
        WHERE group_cd = #{groupCd}
          AND use_yn = 'Y'
        ORDER BY code_cd ASC
    </select>

    <!-- 상위 코드에 따른 하위 코드 목록 조회 (시도 -> 시군구, 시군구 -> 읍면동) -->
    <select id="selectSubCodeList" parameterType="map" resultType="com.psim.web.cmm.vo.CoCodeVO">
        SELECT
        group_cd as groupCd,
        code_cd as codeCd,
        code_nm as codeNm,
        use_yn as useYn
        FROM cpk.tb_co_code
        WHERE group_cd = #{groupCd}
        AND use_yn = 'Y'
        <if test="upperCodeCd != null and upperCodeCd != ''">
            AND SUBSTRING(code_cd, 1, LENGTH(#{upperCodeCd})) = #{upperCodeCd}
        </if>
        ORDER BY code_cd ASC
    </select>

    <!-- 시군구코드에 따른 읍면동 목록 조회 -->
    <select id="selectLdongList" parameterType="string" resultType="com.psim.web.cmm.vo.CoLdongVO">
        SELECT DISTINCT
            tcl.emd_cd AS emdCd,
            tcl.lgal_emd_nm AS lgalEmdNm
        FROM cpk.tb_co_ldong tcl
        WHERE tcl.sigungu_cd = #{sigunguCd}
        ORDER BY tcl.emd_cd ASC
    </select>

</mapper>
