<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.psim.web.cmm.mapper.LoginMapper">
    <select id="findUserById" resultType="com.psim.web.cmm.vo.CoUserVO">
        SELECT  user_id AS userId,
                user_pw AS userPw,
                user_nm AS userNm,
                mbtlnum as mbtlnum,
                sigungu_cd AS sigunguCd,
                LEFT(TRIM(sigungu_cd), 2) AS sidoCd
        FROM    cpk.tb_co_user
        WHERE   user_id = #{userId}
    </select>

    <select id="login" resultType="com.psim.web.cmm.vo.CoUserVO">
        SELECT  user_id AS userId,
                user_pw AS userPw,
                user_nm AS userNm,
                mbtlnum as mbtlnum,
                sigungu_cd AS sigunguCd,
            LEFT(TRIM(sigungu_cd), 2) AS sidoCd
        FROM    cpk.tb_co_user
        WHERE   user_id = #{userId}
          AND   user_pw = #{password}
    </select>

    <select id="loginWithHash" resultType="com.psim.web.cmm.vo.CoUserVO">
        SELECT  user_id AS userId,
                user_pw AS userPw,
                user_nm AS userNm,
                mbtlnum as mbtlnum,
                sigungu_cd AS sigunguCd,
            LEFT(TRIM(sigungu_cd), 2) AS sidoCd
        FROM    cpk.tb_co_user
        WHERE   user_id = #{userId}
          AND   user_pw = #{hashedPassword}
    </select>

    <!-- ðŸ”¥ ì‚¬ìš©ìžê°€ ì ‘ê·¼ ê°€ëŠ¥í•œ ì‚¬ì—…ê´€ë¦¬ë²ˆí˜¸ ëª©ë¡ ì¡°íšŒ -->
    <select id="selectUserBizList" parameterType="string" resultType="string">
        SELECT DISTINCT
            bpp.prk_biz_mng_no
        FROM cpk.tb_biz_per_prklot_info bpp
                 INNER JOIN cpk.tb_prk_srvy_biz_info psb
                            ON bpp.prk_biz_mng_no = psb.prk_biz_mng_no
        WHERE bpp.srvy_id = #{srvyId}
          AND psb.use_yn = 'Y'
        ORDER BY bpp.prk_biz_mng_no
    </select>

    <!-- ì‚¬ìš©ìžì˜ ì‚¬ì—…ì •ë³´ ìƒì„¸ ì¡°íšŒ (ì‚¬ì—…ëª… í¬í•¨) -->
    <select id="selectUserBizInfoList" parameterType="String" resultType="java.util.HashMap">
        SELECT DISTINCT
            psb.prk_biz_mng_no,
            psb.biz_nm,
            psb.biz_yy,
            psb.sido_cd,
            psb.sigungu_cd
        FROM tb_biz_per_prklot_info bpp
                 INNER JOIN tb_prk_srvy_biz_info psb
                            ON bpp.prk_biz_mng_no = psb.prk_biz_mng_no
        WHERE bpp.srvy_id = #{srvyId}
          AND psb.use_yn = 'Y'
        ORDER BY psb.biz_yy DESC, psb.biz_nm
    </select>
</mapper>