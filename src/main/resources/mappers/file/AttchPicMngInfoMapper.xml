<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.psim.web.file.mapper.AttchPicMngInfoMapper">

    <!-- ðŸ”¥ ìµœëŒ€ ìˆœë²ˆ ì¡°íšŒ (ì£¼ì°¨ìž¥ìš©) -->
    <select id="selectMaxSeqNo" resultType="java.lang.Integer">
        SELECT COALESCE(MAX(seq_no), 0)
        FROM cpk.tb_attch_pic_mng_info
        WHERE prk_plce_info_sn = #{prkPlceInfoSn}
        <if test="prkImgId != null and prkImgId != ''">
            AND prk_img_id = #{prkImgId}
        </if>
    </select>

    <!-- ðŸ”¥ ìµœëŒ€ ìˆœë²ˆ ì¡°íšŒ (ì´ìš©ì‹¤íƒœìš©) -->
    <select id="selectMaxSeqNoForUsage" resultType="java.lang.Integer">
        SELECT COALESCE(MAX(seq_no), 0)
        FROM cpk.tb_attch_pic_mng_info
        WHERE cmpl_sn = #{cmplSn}
        <if test="prkImgId != null and prkImgId != ''">
            AND prk_img_id = #{prkImgId}
        </if>
    </select>


    <!-- ðŸ”¥ INSERT - cmpl_sn ì¶”ê°€ -->
    <insert id="insertAttchPicMngInfo" parameterType="com.psim.web.file.vo.AttchPicMngInfoVO">
        INSERT INTO cpk.tb_attch_pic_mng_info (
            prk_plce_manage_no,
            prk_plce_info_sn,
            prk_plce_type,
            prk_oper_type,
            seq_no,
            ext_nm,
            file_path,
            file_nm,
            real_file_nm,
            prk_img_id,
            cmpl_sn,
            attach_type,
            reg_dt,
            rgst_id,
            rgst_ip_addr
        ) VALUES (
                     #{prkPlceManageNo},
                     #{prkPlceInfoSn},
                     #{prkPlceType},
                     #{prkOperType},
                     #{seqNo},
                     #{extNm},
                     #{filePath},
                     #{fileNm},
                     #{realFileNm},
                     #{prkImgId},
                     #{cmplSn},
                     #{attachType},
                     NOW(),
                     #{rgstId},
                     #{rgstIpAddr}
                 )
    </insert>

    <!-- ðŸ”¥ SELECT - cmpl_snìœ¼ë¡œë„ ì¡°íšŒ ê°€ëŠ¥ -->
    <select id="selectAttchPicMngInfoList" resultType="com.psim.web.file.vo.AttchPicMngInfoVO">
        SELECT
        prk_plce_manage_no AS prkPlceManageNo,
        prk_plce_info_sn AS prkPlceInfoSn,
        prk_plce_type AS prkPlceType,
        prk_oper_type AS prkOperType,
        seq_no AS seqNo,
        ext_nm AS extNm,
        file_path AS filePath,
        file_nm AS fileNm,
        real_file_nm AS realFileNm,
        prk_img_id AS prkImgId,
        cmpl_sn AS cmplSn,
        attach_type AS attachType,
        reg_dt AS regDt,
        rgst_id AS rgstId,
        rgst_ip_addr AS rgstIpAddr,
        updt_dt AS updtDt,
        updusr_id AS updusrId,
        updusr_ip_addr AS updusrIpAddr
        FROM cpk.tb_attch_pic_mng_info
        WHERE 1=1
        <if test="prkPlceManageNo != null and prkPlceManageNo != ''">
            AND prk_plce_manage_no = #{prkPlceManageNo}
        </if>
        <if test="prkPlceInfoSn != null">
            AND prk_plce_info_sn = #{prkPlceInfoSn}
        </if>
        <if test="prkImgId != null and prkImgId != ''">
            AND prk_img_id = #{prkImgId}
        </if>
        <if test="seqNo != null">
            AND seq_no = #{seqNo}
        </if>
        <if test="cmplSn != null and cmplSn != ''">
            AND cmpl_sn = #{cmplSn}
        </if>
        ORDER BY seq_no ASC
    </select>
<!--
    &lt;!&ndash; ðŸ”¥ ìµœëŒ€ ìˆœë²ˆ ì¡°íšŒ - cmpl_sn ì¡°ê±´ ì¶”ê°€ &ndash;&gt;
    <select id="selectMaxSeqNo" resultType="java.lang.Integer">
        SELECT COALESCE(MAX(seq_no), 0)
        FROM tb_attch_pic_mng_info
        WHERE 1=1
        <choose>
            <when test="cmplSn != null and cmplSn != ''">
                AND cmpl_sn = #{cmplSn}
            </when>
            <otherwise>
                AND prk_plce_info_sn = #{prkPlceInfoSn}
            </otherwise>
        </choose>
        <if test="prkImgId != null and prkImgId != ''">
            AND prk_img_id = #{prkImgId}
        </if>
    </select>-->

    <!-- ðŸ”¥ UPDATE -->
    <update id="updateAttchPicMngInfo" parameterType="com.psim.web.file.vo.AttchPicMngInfoVO">
        UPDATE cpk.tb_attch_pic_mng_info
        SET
        ext_nm = #{extNm},
        file_path = #{filePath},
        file_nm = #{fileNm},
        real_file_nm = #{realFileNm},
        updt_dt = NOW(),
        updusr_id = #{updusrId},
        updusr_ip_addr = #{updusrIpAddr}
        WHERE 1=1
        <choose>
            <when test="cmplSn != null and cmplSn != ''">
                AND cmpl_sn = #{cmplSn}
            </when>
            <otherwise>
                AND prk_plce_info_sn = #{prkPlceInfoSn}
            </otherwise>
        </choose>
        AND prk_img_id = #{prkImgId}
        AND seq_no = #{seqNo}
    </update>

    <!-- ðŸ”¥ DELETE -->
    <delete id="deleteAttchPicMngInfo">
        DELETE FROM cpk.tb_attch_pic_mng_info
        WHERE 1=1
        <choose>
            <when test="cmplSn != null and cmplSn != ''">
                AND cmpl_sn = #{cmplSn}
            </when>
            <otherwise>
                AND prk_plce_info_sn = #{prkPlceInfoSn}
            </otherwise>
        </choose>
        <if test="prkImgId != null and prkImgId != ''">
            AND prk_img_id = #{prkImgId}
        </if>
        <if test="seqNo != null">
            AND seq_no = #{seqNo}
        </if>
    </delete>

    <!-- ðŸ”¥ ë‹¨ì†ì¼ë ¨ë²ˆí˜¸ë¡œ íŒŒì¼ ëª©ë¡ ì¡°íšŒ -->
    <select id="selectAttchPicMngInfoListByCmplSn" resultType="com.psim.web.file.vo.AttchPicMngInfoVO">
        SELECT
        cmpl_sn AS cmplSn,
        prk_img_id AS prkImgId,
        seq_no AS seqNo,
        real_file_nm AS realFileNm,
        file_nm AS fileNm,
        file_path AS filePath,
        ext_nm AS extNm,
        reg_dt AS regDt,
        rgst_id AS rgstId,
        rgst_ip_addr AS rgstIpAddr
        FROM cpk.tb_attch_pic_mng_info
        WHERE cmpl_sn = #{cmplSn}
        <if test="prkImgId != null and prkImgId != ''">
            AND prk_img_id = #{prkImgId}
        </if>
        ORDER BY seq_no
    </select>

    <!-- ðŸ”¥ ì£¼ì°¨ìž¥ ì •ë³´ ì¼ë ¨ë²ˆí˜¸ë¡œ ì‚¬ì§„ ëª©ë¡ ì¡°íšŒ -->
    <select id="selectPhotosByPrkPlceInfoSn" resultType="map">
        SELECT
            prk_plce_info_sn AS prkPlceInfoSn,
            prk_img_id AS prkImgId,
            seq_no AS seqNo,
            real_file_nm AS realFileNm,
            file_nm AS fileNm,
            file_path AS filePath,
            ext_nm AS extNm,
            reg_dt AS regDt
        FROM cpk.tb_attch_pic_mng_info
        WHERE prk_plce_info_sn = #{prkPlceInfoSn}
        ORDER BY prk_img_id, seq_no
    </select>

    <!-- ðŸ”¥ ì‚¬ì§„ íŒŒì¼ ë°ì´í„° ì¡°íšŒ (prkPlceInfoSn + prkImgId + seqNo ë³µí•©í‚¤) -->
    <select id="selectPhotoFile" resultType="map">
        SELECT
            file_nm AS fileName,
            ext_nm AS extNm,
            file_path AS filePath,
            real_file_nm AS realFileNm
        FROM cpk.tb_attch_pic_mng_info
        WHERE prk_plce_info_sn = #{prkPlceInfoSn}
          AND prk_img_id = #{prkImgId}
          AND seq_no = #{seqNo}
    </select>

    <!-- ðŸ”¥ ì´ìš©ì‹¤íƒœ íŒŒì¼ ì¡°íšŒ (cmplSn + prkImgId + seqNo ë³µí•©í‚¤) -->
    <select id="selectPhotoFileForUsage" resultType="map">
        SELECT
            file_nm AS fileName,
            ext_nm AS extNm,
            file_path AS filePath,
            real_file_nm AS realFileNm
        FROM cpk.tb_attch_pic_mng_info
        WHERE cmpl_sn = #{cmplSn}
          AND prk_img_id = #{prkImgId}
          AND seq_no = #{seqNo}
    </select>

</mapper>
