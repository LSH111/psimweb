<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.psim.web.file.mapper.AttchPicMngInfoMapper">

    <!-- ðŸ”¥ INSERT -->
    <insert id="insertAttchPicMngInfo" parameterType="AttchPicMngInfoVO">
        INSERT INTO tb_attch_pic_mng_info (
            prk_plce_info_sn,
            prk_plce_type,
            prk_oper_type,
            seq_no,
            ext_nm,
            file_path,
            file_nm,
            real_file_nm,
            prk_img_id,
            reg_dt,
            rgst_id,
            rgst_ip_addr
        ) VALUES (
                     #{prkPlceInfoSn},
                     #{prkPlceType},
                     #{prkOperType},
                     #{seqNo},
                     #{extNm},
                     #{filePath},
                     #{fileNm},
                     #{realFileNm},
                     #{prkImgId},
                     NOW(),
                     #{rgstId},
                     #{rgstIpAddr}
                 )
    </insert>

    <!-- ðŸ”¥ UPDATE -->
    <update id="updateAttchPicMngInfo" parameterType="AttchPicMngInfoVO">
        UPDATE tb_attch_pic_mng_info
        SET
            ext_nm = #{extNm},
            file_path = #{filePath},
            file_nm = #{fileNm},
            real_file_nm = #{realFileNm},
            updt_dt = NOW(),
            updusr_id = #{updusrId},
            updusr_ip_addr = #{updusrIpAddr}
        WHERE prk_plce_info_sn = #{prkPlceInfoSn}
          AND prk_img_id = #{prkImgId}
          AND seq_no = #{seqNo}
    </update>

    <!-- ðŸ”¥ SELECT -->
    <select id="selectAttchPicMngInfoList" resultType="AttchPicMngInfoVO">
        SELECT
        prk_plce_info_sn AS prkPlceInfoSn,
        prk_plce_type AS prkPlceType,
        prk_oper_type AS prkOperType,
        seq_no AS seqNo,
        ext_nm AS extNm,
        file_path AS filePath,
        file_nm AS fileNm,
        real_file_nm AS realFileNm,
        prk_img_id AS prkImgId,
        reg_dt AS regDt,
        rgst_id AS rgstId,
        rgst_ip_addr AS rgstIpAddr,
        updt_dt AS updtDt,
        updusr_id AS updusrId,
        updusr_ip_addr AS updusrIpAddr
        FROM tb_attch_pic_mng_info
        WHERE prk_plce_info_sn = #{prkPlceInfoSn}
        <if test="prkImgId != null and prkImgId != ''">
            AND prk_img_id = #{prkImgId}
        </if>
        <if test="seqNo != null">
            AND seq_no = #{seqNo}
        </if>
        ORDER BY seq_no ASC
    </select>

    <!-- ðŸ”¥ ìµœëŒ€ ìˆœë²ˆ ì¡°íšŒ -->
    <select id="selectMaxSeqNo" resultType="java.lang.Integer">
        SELECT COALESCE(MAX(seq_no), 0)
        FROM tb_attch_pic_mng_info
        WHERE prk_plce_info_sn = #{prkPlceInfoSn}
          AND prk_img_id = #{prkImgId}
    </select>

    <!-- ðŸ”¥ DELETE -->
    <delete id="deleteAttchPicMngInfo">
        DELETE FROM tb_attch_pic_mng_info
        WHERE prk_plce_info_sn = #{prkPlceInfoSn}
        AND prk_img_id = #{prkImgId}
        <if test="seqNo != null">
            AND seq_no = #{seqNo}
        </if>
    </delete>

</mapper>